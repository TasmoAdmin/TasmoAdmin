var Sonoff,refreshtime=!1,nightmode=!1;function notifyMe(t,S){""!==(S=S||"")&&(S=" - "+S);if("Notification"in window)if("granted"===Notification.permission){var e=new Notification("TasmoAdmin"+S,{body:t,icon:"./resources/img/favicons/apple-icon-180x180.png"});setTimeout(e.close.bind(e),3e3)}else"denied"!==Notification.permission&&Notification.requestPermission((function(e){if("granted"===e){var s=new Notification("TasmoAdmin"+S,{body:t});setTimeout(s.close.bind(s),3e3)}}))}$(document).on("ready",(function(){var t=$("html").attr("lang"),S=_BASEURL_+"tmp/cache/i18n/json_i18n_"+t+".cache.json";$.ajax({dataType:"json",url:S,async:!1,success:function(t){$.i18n().load(t)}}),checkNightmode(nightmodeconfig),checkForUpdate(!0),$(".double-scroll").doubleScroll({contentElement:"#device-list",scrollCss:{"overflow-x":"auto","overflow-y":"hidden"},contentCss:{"overflow-x":"auto","overflow-y":"hidden"},onlyIfScroll:!0,resetOnWindowResize:!0,timeToWaitForResize:1}),Sonoff=new Sonoff({timeout:15}),$('[title][title!=""]').tooltip({html:!0,delay:300}),$(".custom-file-input").on("change",(function(){var t=$(this).val();t=(t=t.replace(/^.*\\/,"")).match(/[^\\/]*$/)[0],$(this).next().html(t)})),$("a.reload").on("click",(function(t){t.preventDefault(),window.location.href=window.location.href})),$("#versionHolder").on("click",(function(t){t.preventDefault(),$(this).hasClass("update-now")||"0"===$("#versionHolder").data("update-check")?window.location.href=_BASEURL_+"selfupdate":checkForUpdate(!1)}));"none"!==$("#content").data("refreshtime")&&(refreshtime=1e3*$("#content").data("refreshtime")),$('input[type="number"]').keydown((function(t){-1!==$.inArray(t.keyCode,[46,8,9,27,13,110,190])||65===t.keyCode&&(!0===t.ctrlKey||!0===t.metaKey)||t.keyCode>=35&&t.keyCode<=40||(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault()})),$("select#language-switch").on("change",(function(t,S){$("option:selected",this);var e=this.value,s=window.location.toString()+"/"+e+"/";s=s.replace(/([^:]\/)\/+/g,"$1"),window.location.href=s})),$("body").on("click",".show-hide-password",(function(t){let S=$(this).closest(".input-group").find("input");"password"===S.attr("type")?(S.attr("type","text"),$(this).find("i").addClass("fa-eye-slash")):($(this).find("i").removeClass("fa-eye-slash"),S.attr("type","password"))}))})),$.fn.attachDragger=function(){var t,S,e,s=!1;$($(this).selector).on("mousedown mouseup mousemove",(function(a){"mousedown"!==a.type||$(a.target).hasClass("tablesaw-cell-content")||(s=!0,t=[a.clientX,a.clientY],$(".tablesaw-cell-content").addClass("dontselect")),"mouseup"===a.type&&(s=!1,$(".tablesaw-cell-content").removeClass("dontselect")),"mousemove"===a.type&&!0===s&&(S=[a.clientX,a.clientY],e=[S[0]-t[0],S[1]-t[1]],$(this).scrollLeft($(this).scrollLeft()-e[0]),$(this).scrollTop($(this).scrollTop()-e[1]),t=[a.clientX,a.clientY])})),$(window).on("mouseup",(function(){s=!1,$(".tablesaw-cell-content").removeClass("dontselect")}))};var parseVersion=function(t){var S=(t=t.replace("-minimal","").replace(/\./g,"")).slice(-1);return isNaN(S)?t=t.replace(S,S.charCodeAt(0)-97<10?"0"+(S.charCodeAt(0)-97):S.charCodeAt(0)-97):t+="00",t};function getTemp(t,S){var e=[];S=S||"<br/>";return void 0===t.StatusSNS.TempUnit&&(t.StatusSNS.TempUnit="F"),void 0!==t.StatusSNS.DS18B20&&e.push(t.StatusSNS.DS18B20.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20&&(void 0!==t.StatusSNS.DS18x20.DS1&&e.push(t.StatusSNS.DS18x20.DS1.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS2&&e.push(t.StatusSNS.DS18x20.DS2.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS3&&e.push(t.StatusSNS.DS18x20.DS3.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS4&&e.push(t.StatusSNS.DS18x20.DS4.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS5&&e.push(t.StatusSNS.DS18x20.DS5.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS6&&e.push(t.StatusSNS.DS18x20.DS6.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS7&&e.push(t.StatusSNS.DS18x20.DS7.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS8&&e.push(t.StatusSNS.DS18x20.DS8.Temperature+"°"+t.StatusSNS.TempUnit)),void 0!==t.StatusSNS["DS18B20-1"]&&e.push(t.StatusSNS["DS18B20-1"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-2"]&&e.push(t.StatusSNS["DS18B20-2"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-3"]&&e.push(t.StatusSNS["DS18B20-3"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-4"]&&e.push(t.StatusSNS["DS18B20-4"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-5"]&&e.push(t.StatusSNS["DS18B20-5"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-6"]&&e.push(t.StatusSNS["DS18B20-6"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-7"]&&e.push(t.StatusSNS["DS18B20-7"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-8"]&&e.push(t.StatusSNS["DS18B20-8"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DHT11&&e.push(t.StatusSNS.DHT11.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.AM2301&&e.push(t.StatusSNS.AM2301.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.SHT3X&&e.push(t.StatusSNS.SHT3X.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["SHT3X-0x45"]&&e.push(t.StatusSNS["SHT3X-0x45"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.BMP280&&e.push(t.StatusSNS.BMP280.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.BME680&&e.push(t.StatusSNS.BME680.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.BME280&&e.push(t.StatusSNS.BME280.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["BME280-76"]&&e.push(t.StatusSNS["BME280-76"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["BME280-77"]&&e.push(t.StatusSNS["BME280-77"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.SI7021&&e.push(t.StatusSNS.SI7021.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.HTU21&&e.push(t.StatusSNS.HTU21.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.BMP180&&e.push(t.StatusSNS.BMP180.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.LM75AD&&e.push(t.StatusSNS.LM75AD.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.MAX31855&&e.push(t.StatusSNS.MAX31855.ProbeTemperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.AHT1X&&e.push(t.StatusSNS.AHT1X.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["AHT1X-0x38"]&&e.push(t.StatusSNS["AHT1X-0x38"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["AHT1X-0x39"]&&e.push(t.StatusSNS["AHT1X-0x39"].Temperature+"°"+t.StatusSNS.TempUnit),e.join(S)}function getHumidity(t,S){var e=[];S=S||"<br/>";return void 0!==t.StatusSNS.AM2301&&void 0!==t.StatusSNS.AM2301.Humidity&&e.push(t.StatusSNS.AM2301.Humidity+"%"),void 0!==t.StatusSNS.BME280&&void 0!==t.StatusSNS.BME280.Humidity&&e.push(t.StatusSNS.BME280.Humidity+"%"),void 0!==t.StatusSNS["BME280-76"]&&void 0!==t.StatusSNS["BME280-76"].Humidity&&e.push(t.StatusSNS["BME280-76"].Humidity+"%"),void 0!==t.StatusSNS["BME280-77"]&&void 0!==t.StatusSNS["BME280-77"].Humidity&&e.push(t.StatusSNS["BME280-77"].Humidity+"%"),void 0!==t.StatusSNS.BME680&&void 0!==t.StatusSNS.BME680.Humidity&&e.push(t.StatusSNS.BME680.Humidity+"%"),void 0!==t.StatusSNS.DHT11&&void 0!==t.StatusSNS.DHT11.Humidity&&e.push(t.StatusSNS.DHT11.Humidity+"%"),void 0!==t.StatusSNS.SHT3X&&void 0!==t.StatusSNS.SHT3X.Humidity&&e.push(t.StatusSNS.SHT3X.Humidity+"%"),void 0!==t.StatusSNS["SHT3X-0x45"]&&void 0!==t.StatusSNS["SHT3X-0x45"].Humidity&&e.push(t.StatusSNS["SHT3X-0x45"].Humidity+"%"),void 0!==t.StatusSNS.SI7021&&void 0!==t.StatusSNS.SI7021.Humidity&&e.push(t.StatusSNS.SI7021.Humidity+"%"),void 0!==t.StatusSNS.HTU21&&void 0!==t.StatusSNS.HTU21.Humidity&&e.push(t.StatusSNS.HTU21.Humidity+"%"),e.join(S)}function getPressure(t,S){var e=[];S=S||"<br/>";return void 0!==t.StatusSNS.BME280&&void 0!==t.StatusSNS.BME280.Pressure&&e.push(t.StatusSNS.BME280.Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS["BME280-76"]&&void 0!==t.StatusSNS["BME280-76"].Pressure&&e.push(t.StatusSNS["BME280-76"].Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS["BME280-77"]&&void 0!==t.StatusSNS["BME280-77"].Pressure&&e.push(t.StatusSNS["BME280-77"].Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS.BMP280&&void 0!==t.StatusSNS.BMP280.Pressure&&e.push(t.StatusSNS.BMP280.Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS.BME680&&void 0!==t.StatusSNS.BME680.Pressure&&e.push(t.StatusSNS.BME680.Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS.BMP180&&void 0!==t.StatusSNS.BMP180.Pressure&&e.push(t.StatusSNS.BMP180.Pressure+"&nbsp;hPa"),e.join(S)}function getSeaPressure(t,S){var e=[];S=S||"<br/>";return void 0!==t.StatusSNS.BME280&&void 0!==t.StatusSNS.BME280.SeaPressure&&e.push(t.StatusSNS.BME280.SeaPressure+"&nbsp;hPa"),void 0!==t.StatusSNS["BME280-76"]&&void 0!==t.StatusSNS["BME280-76"].SeaPressure&&e.push(t.StatusSNS["BME280-76"].SeaPressure+"&nbsp;hPa"),void 0!==t.StatusSNS["BME280-77"]&&void 0!==t.StatusSNS["BME280-77"].SeaPressure&&e.push(t.StatusSNS["BME280-77"].SeaPressure+"&nbsp;hPa"),void 0!==t.StatusSNS.BMP280&&void 0!==t.StatusSNS.BMP280.SeaPressure&&e.push(t.StatusSNS.BMP280.SeaPressure+"&nbsp;hPa"),void 0!==t.StatusSNS.BMP180&&void 0!==t.StatusSNS.BMP180.SeaPressure&&e.push(t.StatusSNS.BMP180.SeaPressure+"&nbsp;hPa"),e.join(S)}function getDistance(t,S){var e=[];S=S||"<br/>";return void 0!==t.StatusSNS.SR04&&void 0!==t.StatusSNS.SR04.Distance&&e.push(t.StatusSNS.SR04.Distance+"cm"),e.join(S)}function getEnergyPower(t,S){var e=[];S=S||"<br/>";if(void 0!==t.StatusSNS.ENERGY){if(void 0!==t.StatusSNS.ENERGY.Power&&e.push(t.StatusSNS.ENERGY.Power+"W"),void 0!==t.StatusSNS.ENERGY.Today){var s=t.StatusSNS.ENERGY.Today;void 0!==t.StatusSNS.ENERGY.Yesterday&&(s+="/"+t.StatusSNS.ENERGY.Yesterday),e.push(s+"kWh")}void 0!==t.StatusSNS.ENERGY.Current&&e.push(t.StatusSNS.ENERGY.Current+"A")}return e.join(S)}function getGas(t,S){var e=[];S=S||"<br/>";return void 0!==t.StatusSNS.BME680&&void 0!==t.StatusSNS.BME680.Gas&&e.push(t.StatusSNS.BME680.Gas+"kOhm"),e.join(S)}function checkNightmode(t){console.log("[APP][checkNightmode] Start");t=t||"auto";var S=(new Date).getHours();"disable"===t?($("body").removeClass("nightmode"),console.log("[APP][checkNightmode] disabled")):"auto"===t?(console.log("[APP][checkNightmode] check time"),S>=18||S<=8?($("body").addClass("nightmode"),console.log("[APP][checkNightmode] its night")):($("body").removeClass("nightmode"),console.log("[APP][checkNightmode] its day")),setTimeout((function(){checkNightmode(t)}),9e5)):"always"===t&&(console.log("[APP][checkNightmode] always"),$("body").addClass("nightmode")),$("body").hasClass("nightmode")&&(nightmode=!0)}function checkForUpdate(t){if("0"===$("#versionHolder").data("update-check"))return console.log("[APP][checkForUpdate] Update check is disabed"),void $("#update-icon").remove();console.log("[APP][checkForUpdate] Start");t=t||!0;var S=$("#update-icon"),e=S.data("current_git_tag"),s=S.data("update_channel");if(S.parent().hasClass("update-now"))return console.log("[APP][checkForUpdate] NEW VERSION FOUND ALREADY"),!0;if(S.hasClass("fa-spin"))return console.log("[APP][checkForUpdate] Still searching"),!1;S.removeClass("fa-check").removeClass("fa-question").removeClass("fa-times").addClass("fa-sync").addClass("fa-spin");var a="releases/latest";"stable"!==s&&(a="releases");var u="https://api.github.com/repos/reloxx13/TasmoAdmin/"+a;$.get(u,{},(function(s){if(void 0!==s)if(Array.isArray(s)&&(s=s[0]),void 0!==s.tag_name){var a=s.tag_name;console.log("[APP][checkForUpdate] latestTag => "+a),a!==e?(console.log("[APP][checkForUpdate] NEW VERSION FOUND"),3!==s.assets.length?(console.log("[APP][checkForUpdate] Seems like Travis is not done yet"),S.removeClass("fa-sync").addClass("fa-check"),t&&setTimeout(checkForUpdate,3e5)):S.removeClass("fa-sync").removeClass("fa-spin").addClass("fa-cloud-download-alt").parent().addClass("update-now")):(console.log("[APP][checkForUpdate] No update found"),S.removeClass("fa-sync").addClass("fa-check"),t&&setTimeout(checkForUpdate,9e5))}else void 0!==s.message&&(S.removeClass("fa-sync").removeClass("fa-spin").addClass("fa-times"),console.log("[APP][checkForUpdate] Github Error => "+s.message),setTimeout(checkForUpdate,18e5));S.removeClass("fa-spin")}),"json").fail((function(t){S.removeClass("fa-sync").removeClass("fa-spin").addClass("fa-times"),console.log("[APP][checkForUpdate] Github Error => "+t.status+": "+t.responseJSON.message),setTimeout(checkForUpdate,18e5)}))}Date.prototype.addHours=function(t){return this.setHours(this.getHours()+t),this},jQuery.fn.shake=function(t,S,e){return this.each((function(){$(this).css("position","relative");for(var s=1;s<=t;s++)$(this).animate({left:-1*S},e/t/4).animate({left:S},e/t/2).animate({left:0},e/t/4)})),this};